<!--
Created by Matt Kennedy, 2011-2012.
Property of Matt Kennedy and Southampton Solent University.
-->

<!--
Todo/ideas:
slidey thing from the left, a control panel to start new games, add cards etc?
Dimensions of cards- 0.7:1

For drag and drop look into 'sortable' jqueryui.

initialise function for reset

change cards to have id as well as class

drag over library, layover on card with 'add to library'

stopimmediatepropagation: stops all following functions with same name from calling

store cards in localstorage, convert to javascript array? no database
-->

<!DOCTYPE html>
<html>
<head>
	<title>Tap'd</title>
	<link rel="stylesheet" type="text/css" href="main.css" />
	<script type='text/javascript' src='jquery.js'></script>
	<script type='text/javascript' src='jquery-ui.js'></script>
	
	<script type='text/javascript'>	
	$(document).ready(onLoad);

	function onLoad() {

		var libraryArray = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];
		var graveyardArray = [];
		var exiledArray = [];
		$(".graveyardPlaceholder").hide();
		$(".exiledPlaceholder").hide();

		$(".card").draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card",
			stop: function(event, ui){ $('body').css('cursor','default') }
		});		

		$(".cardback").draggable({ cursor: 'move', revert: 'invalid',
			helper: "clone",
			stop: function(event, ui){ $('body').css('cursor','default') }
		});	

		$(".graveyardPlaceholder").draggable({ cursor: 'move',
			helper: "clone",
			stop: function(event, ui){ $('body').css('cursor','default') },
			start: function(event, ui) { 
				if(graveyardArray.length == 1) 
				{
					$(".graveyardPlaceholder").hide();
					ui.helper.show();
				}
				else if(graveyardArray.length > 1) 
				{
					var text = graveyardArray[1];
					$(".graveyardPlaceholder").html(text);
					ui.helper.html(graveyardArray[0]);
				}
			}
		});	

		$(".exiledPlaceholder").draggable({ cursor: 'move',
			helper: "clone",
			stop: function(event, ui){ $('body').css('cursor','default') }
		});	

			
			
		$("#container").droppable({
			accept: function(d)
			{
				if((d.hasClass("cardback"))||(d.hasClass("graveyardPlaceholder"))
					||(d.hasClass("exiledPlaceholder")))
				{ return true; }
			},
			tolerance: 'pointer',
			drop: function(event, ui) {
				if(ui.draggable.hasClass("cardback"))
				{
					var cardName = $(libraryArray).get(0);
					libraryArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('cardback')
				      .attr('id', cardName)
				      .html(cardName);
				    if(libraryArray.length == 0) { $(".cardback").hide(); }
				    $("#container").append(newDiv);
				    $(".card").draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card" });
				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');	
			    }
			    else if (ui.draggable.hasClass("graveyardPlaceholder"))   
			    {
			    	var cardName = $(graveyardArray).get(0);
					graveyardArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('graveyardPlaceholder')
				      .attr('id', cardName)
				      .html(cardName);
				    if(graveyardArray.length == 0) { $(".graveyardPlaceholder").hide(); }
				    $("#container").append(newDiv);
				    $(".card").draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card" });
				    var graveyardTop = graveyardArray[0];
				    $(".graveyardPlaceholder").html(graveyardTop);	
				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');
			    }
			    else if (ui.draggable.hasClass("exiledPlaceholder"))   
			    {
			    	var cardName = $(exiledArray).get(0);
					exiledArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('exiledPlaceholder')
				      .attr('id', cardName)
				      .html(cardName);
				    if(exiledArray.length == 0) { $(".exiledPlaceholder").hide(); }
				    $("#container").append(newDiv);
				    $(".card").draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card" });
				    var exiledTop = exiledArray[0];
				    $(".exiledPlaceholder").html(exiledTop);	
				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');
			    }
			}
		});

		$("#library").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#library").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#library").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#library").css('border-color', '#d6d3c0');				
					$(".cardback").show();
					var cardID = ui.draggable.attr("id");
					ui.draggable.remove();			
					libraryArray.unshift(cardID);
					$('body').css('cursor','default');								
			}
		});	

		$("#battlefield").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#battlefield").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#battlefield").css('border-color', '#d6d3c0');
			}
			,
			drop: function(event, ui){
				$("#battlefield").css('border-color', '#d6d3c0');
			}
		});

		$("#graveyard").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#graveyard").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#graveyard").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#graveyard").css('border-color', '#d6d3c0');
				var cardID = ui.draggable.attr("id");
				ui.draggable.remove();
				if(graveyardArray.length == 0) { $(".graveyardPlaceholder").show(); }			
				graveyardArray.unshift(cardID);
				$(".graveyardPlaceholder").html(cardID);		
				$('body').css('cursor','default');
			}
		});

		$("#exile").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#exile").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#exile").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#exile").css('border-color', '#d6d3c0');
				var cardID = ui.draggable.attr("id");
				ui.draggable.remove();
				if(exiledArray.length == 0) { $(".exiledPlaceholder").show(); }			
				exiledArray.unshift(cardID);
				$(".exiledPlaceholder").html(cardID);
				$('body').css('cursor','default');
			}
		});

		$("#hand").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#hand").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#hand").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#hand").css('border-color', '#d6d3c0');
			}
		});
	};
	</script>
</head>


<body>
<div id="container">
	<div id="login"> Username: <input id="username"/> Password: <input id="password" type="password"/> <input id="submit" type="submit" value="Log In"/> </div>
	<a href="index.html"><div id="logoDiv"></div></a>
	
	<div id="battlefield">
		<div id="crystalline_sliver_1" class="card">
			<div class="cardName"> Crystalline Sliver</div>
			<div class="cardCost"> UW </div>
			<div class="cardText"> All slivers have shroud. </div>
			<br /><br />
			<div class="cardToughness"> 2 </div>
			<div class="cardPower"> 2 </div>
		</div>
	</div>

	<div id="info">
		<div id="topinfo">
			<a href="add_deck.html"><button name="addcard" type="button">Add Deck</button></a>
			<a href="xmlscript.php"><button name="xmlscript" type="button">xmlscript</button></a>
			<br />
		</div>
		
		<div id="cardinfo">Card Information</div>
	</div>
	
	<div id="bottomContainer">
		<div id="hand">
			<div id="card1" class="card"></div>
			<!-- <div class="card"></div>
			<div class="card"></div>
			<div class="card"></div>
			<div class="card"></div>
			<div class="card"></div>
			<div class="card"></div> -->
		</div>

		<div id="library"> Library <br />
			<div class="cardback"></div>
		</div>

		<div id="graveyard">Graveyard <br />
			<div class="graveyardPlaceholder"></div>
		</div>
		<div id="exile">Exiled <br />
			<div class="exiledPlaceholder"></div>
		</div>
	</div>
</div>
</body>
</html>