<!--
Created by Matt Kennedy, 2011-2012.
Property of Matt Kennedy and Southampton Solent University.

Todo/ideas:
Dimensions of cards- 0.7:1

css3 page transitions? single file different divs for pages- maintain state of game

drag over library, layover on card with 'add to library'
stopimmediatepropagation: stops all following functions with same name from calling
add a token card to the field- specify text and can duplicate
draw seven cards for hand
mulligan
send card to top/bottom
flip card
-->

<!DOCTYPE html>
<html>
<head>
	<title>Tap'd</title>
	<link rel="stylesheet" type="text/css" href="main.css" />
	<script type='text/javascript' src='jquery.js'></script>
	<script type='text/javascript' src='jquery-ui.js'></script>
	
	<script type='text/javascript'>
	$(document).ready(onLoad);

	function onLoad() {
		var libraryArray = [];
		var tappedArray = [];

		var clickStart, clickStop, diff;
		var clickTime = 100;

		if(localStorage.length == 0)
		{
			$(".cardback").hide();
		}
		else
		{
			for(var i=0; i < localStorage.length; i++)
			{
				var j = localStorage.key(i);
				libraryArray.push(j);
				j++;
			}
		}

		shuffle = function(v){
		    for(var j, x, i = v.length; i; j = parseInt(Math.random() * i), x = v[--i], v[i] = v[j], v[j] = x);
		    return v;
		};

		shuffle(libraryArray);

		var graveyardArray = [];
		var exiledArray = [];
		$("#libCounter").html(libraryArray.length);
		$("#graveyardCounter").html(graveyardArray.length);
		$("#exiledCounter").html(exiledArray.length);

		$(".graveyardPlaceholder").hide();
		$(".exiledPlaceholder").hide();

		$(".card").draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card", delay: 50,
			stop: function(event, ui){
				$('body').css('cursor','default');}})
		.click(function(){
			var id = $(this).attr("id");
			if($(this).hasClass("cardTapped"))
			{
				$(this).removeClass("cardTapped");
			}else{
			$(this).addClass("cardTapped");
			}
		});

		$(".cardback").draggable({ cursor: 'move', revert: 'invalid',
			helper: "clone",
			start: function(event, ui){ $('#libCounter').html(libraryArray.length-1) },
			stop: function(event, ui){ $('body').css('cursor','default') }
		});	

		$(".graveyardPlaceholder").draggable({ cursor: 'move',
			helper: "clone",
			stop: function(event, ui){ $('body').css('cursor','default') },
			start: function(event, ui) { 
				if(graveyardArray.length == 1) 
				{
					$("#graveyardCounter").html("0");
					var cardID = $(graveyardArray).get(0);
					var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];

					$(".graveyardPlaceholder").hide();
					ui.helper.html(name + " " + cost + "<br />" + type + "<br />"
											+ text + "<br />" + power+"/"+toughness);
					ui.helper.show();
				}
				else if(graveyardArray.length > 1) 
				{
					$("#graveyardCounter").html(graveyardArray.length-1);
					var cardID = $(graveyardArray).get(0);
					var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];
					
					var cardID_1 = $(graveyardArray).get(1);
					var getCardValues_1 = localStorage.getItem(cardID_1);
					var values_1 = getCardValues_1.split(";");
					var name_1 = values_1[0];
					var cost_1 = values_1[1];
					var type_1 = values_1[2];
					var text_1 = values_1[3];
					var power_1 = values_1[4];
					var toughness_1 = values_1[5];				

					$(".graveyardPlaceholder").html(name_1 + " " + cost_1 + "<br />" + type_1 + "<br />" 
											+ text_1 + "<br />" + power_1+"/"+toughness_1);
					ui.helper.html(name + " " + cost + "<br />"  + type + "<br />"
											+ text + "<br />" + power+"/"+toughness);
					ui.helper.show();
				}
			}
		});	

		$(".exiledPlaceholder").draggable({ cursor: 'move',
			helper: "clone",
			stop: function(event, ui){ $('body').css('cursor','default')}, 
			start: function(event, ui) { 
				if(exiledArray.length == 1) 
				{
					$("#exiledCounter").html("0");
					var cardID = $(exiledArray).get(0);
					var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];

					$(".exiledPlaceholder").hide();
					ui.helper.html(name + " " + cost + "<br />" + type + "<br />"
											+ text + "<br />" + power+"/"+toughness);
					ui.helper.show();				
				}
				else if(exiledArray.length > 1) 
				{
					$("#exiledCounter").html(exiledArray.length-1);
					var cardID = $(exiledArray).get(0);
					var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var text = values[2];
					var power = values[3];
					var toughness = values[4];
					
					var cardID_1 = $(exiledArray).get(1);
					var getCardValues_1 = localStorage.getItem(cardID_1);
					var values_1 = getCardValues_1.split(";");
					var name_1 = values_1[0];
					var cost_1 = values_1[1];
					var type_1 = values_1[2];
					var text_1 = values_1[3];
					var power_1 = values_1[4];
					var toughness_1 = values_1[5];					

					$(".exiledPlaceholder").html(name_1 + " " + cost_1 + "<br />" + type_1 + "<br />"
											+ text_1 + "<br />" + power_1+"/"+toughness_1);
					ui.helper.html(name + " " + cost + "<br />"   + type + "<br />"
											+ text + "<br />" + power+"/"+toughness);
					ui.helper.show();
				}
			}
		});	

			
			
		$("#container").droppable({
			tolerance: 'pointer',
			accept: function(d){
				if((d.hasClass("cardback"))||(d.hasClass("graveyardPlaceholder"))
					||(d.hasClass("exiledPlaceholder")))
				{ return true; }
			},		
			drop: function(event, ui) {
				if(ui.draggable.hasClass("cardback"))
				{
					var cardID = $(libraryArray).get(0);
					var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];
					libraryArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('cardback')
				      .attr('id', cardID)
				      .html(name + " " + cost + "<br />" + type + "<br />" + text + "<br />" + power+"/"+toughness);
				    if(libraryArray.length == 0) { $(".cardback").hide(); }
				    $("#container").append(newDiv);
				    $("#libCounter").html(libraryArray.length);

				    $("#"+cardID).draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card", delay: 50,
						stop: function(event, ui){
							$('body').css('cursor','default');}})
					.click(function(){
						var id = $(this).attr("id");
						if($(this).hasClass("cardTapped"))
						{
							$(this).removeClass("cardTapped");
						}else{
						$(this).addClass("cardTapped");
						}
					});

				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');	
			    }
			    else if (ui.draggable.hasClass("graveyardPlaceholder"))   
			    {
			    	var cardID = $(graveyardArray).get(0);
			    	var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];

					graveyardArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('graveyardPlaceholder')
				      .attr('id', cardID)
				      .html(name + " " + cost + "<br />" + type + "<br />" + text + "<br />" + power+"/"+toughness);
				    if(graveyardArray.length == 0) { $(".graveyardPlaceholder").hide(); }
				    $("#container").append(newDiv);
				    $("#graveyardCounter").html(graveyardArray.length);
				    
				    $("#"+cardID).draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card", delay: 50,
						stop: function(event, ui){
							$('body').css('cursor','default');}})
					.click(function(){
						var id = $(this).attr("id");
						if($(this).hasClass("cardTapped"))
						{
							$(this).removeClass("cardTapped");
						}else{
						$(this).addClass("cardTapped");
						}
					});

				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');
			    }
			    else if (ui.draggable.hasClass("exiledPlaceholder"))   
			    {	    	
			    	var cardID = $(exiledArray).get(0);
			    	var getCardValues = localStorage.getItem(cardID);
					var values = getCardValues.split(";");
					var name = values[0];
					var cost = values[1];
					var type = values[2];
					var text = values[3];
					var power = values[4];
					var toughness = values[5];

					exiledArray.splice(0,1);
				    var newDiv = $(ui.helper).clone(false)
				      .addClass('card')
				      .addClass('ui-draggable')
				      .removeClass('ui-draggable-dragging')
				      .removeClass('exiledPlaceholder')
				      .attr('id', cardID)
				      .html(name + " " + cost + "<br />" + type + "<br />" + text + "<br />" + power+"/"+toughness);
				    if(exiledArray.length == 0) { $(".exiledPlaceholder").hide(); }
				    $("#container").append(newDiv);	
				    $("#exiledCounter").html(exiledArray.length);	    
				    
				    $("#"+cardID).draggable({ cursor: 'move', snap: true, snapTolerance: 5, stack: ".card", delay: 50,
						stop: function(event, ui){
							$('body').css('cursor','default');}})
					.click(function(){
						var id = $(this).attr("id");
						if($(this).hasClass("cardTapped"))
						{
							$(this).removeClass("cardTapped");
						}else{
						$(this).addClass("cardTapped");
						}
					});

				    $("#library").css('border-color', '#d6d3c0');
				    $("#hand").css('border-color', '#d6d3c0');
				    $("#graveyard").css('border-color', '#d6d3c0');
				    $("#battlefield").css('border-color', '#d6d3c0');
				    $("#exile").css('border-color', '#d6d3c0');
				    $('body').css('cursor','default');
			    }
			}
		});

		$("#library").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#library").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#library").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#library").css('border-color', '#d6d3c0');				
					$(".cardback").show();
					var cardID = ui.draggable.attr("id");
					ui.draggable.remove();			
					libraryArray.unshift(cardID);
					$('body').css('cursor','default');
					$("#libCounter").html(libraryArray.length);							
			}
		});	

		$("#battlefield").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#battlefield").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#battlefield").css('border-color', '#d6d3c0');
			}
			,
			drop: function(event, ui){
				$("#battlefield").css('border-color', '#d6d3c0');
			}
		});

		$("#graveyard").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#graveyard").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#graveyard").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#graveyard").css('border-color', '#d6d3c0');			
				var cardID = ui.draggable.attr("id");
				var getCardValues = localStorage.getItem(cardID);
				var values = getCardValues.split(";");
				var name = values[0];
				var cost = values[1];
				var type = values[2];
				var text = values[3];
				var power = values[4];
				var toughness = values[5];
				ui.draggable.remove();
				if(graveyardArray.length == 0) { $(".graveyardPlaceholder").show(); }			
				graveyardArray.unshift(cardID);
				$("#graveyardCounter").html(graveyardArray.length);
				$(".graveyardPlaceholder").html(name + " " + cost + "<br />" + type + "<br />" 
							+ text + "<br />" + power+"/"+toughness);		
				$('body').css('cursor','default');
			}
		});

		$("#exile").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#exile").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#exile").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#exile").css('border-color', '#d6d3c0');
				var cardID = ui.draggable.attr("id");
				var getCardValues = localStorage.getItem(cardID);
				var values = getCardValues.split(";");
				var name = values[0];
				var cost = values[1];
				var type = values[2];
				var text = values[3];
				var power = values[4];
				var toughness = values[5];
				ui.draggable.remove();
				if(exiledArray.length == 0) { $(".exiledPlaceholder").show(); }			
				exiledArray.unshift(cardID);
				$("#exiledCounter").html(exiledArray.length);
				$(".exiledPlaceholder").html(name + " " + cost + "<br />" + type + "<br />" 
							+ text + "<br />" + power+"/"+toughness);
				$('body').css('cursor','default');
			}
		});

		$("#hand").droppable({
			tolerance: 'pointer',
			over: function(event, ui){
				$("#hand").css('border-color', 'yellow');
			},
			out: function(event, ui){
				$("#hand").css('border-color', '#d6d3c0');
			},
			drop: function(event, ui){
				$("#hand").css('border-color', '#d6d3c0');
			}
		});
	};
	</script>
</head>


<body>
<div id="container">
	<div id="login"> Username: <input id="username"/> Password: <input id="password" type="password"/> <input id="submit" type="submit" value="Log In"/> </div>
	<a href="index.html"><div id="logoDiv"></div></a>
	
	<div id="battlefield">
	</div>

	<div id="info">
		<div id="topinfo">
			<a href="add_deck.html"><button name="addcard" type="button">Deck Management</button></a>
			<a href="signup.html"><button name="signup" type="button">Register</button></a>
			<br />
		</div>
		
		<div id="cardinfo">Card Information</div>
	</div>
	
	<div id="bottomContainer">
		<div id="hand">
		</div>

		<div id="library">Library<br />
			<p id="libCounter"></p>		
			<div class="cardback"></div>	
		</div>

		<div id="graveyard">Graveyard <br />
			<p id="graveyardCounter"></p>	
			<div class="graveyardPlaceholder"></div>
		</div>
		<div id="exile">Exiled <br />
			<p id="exiledCounter"></p>	
			<div class="exiledPlaceholder"></div>
		</div>
	</div>
</div>
</body>
</html>